name: Build WinPython Portable Bundle

on:
  workflow_dispatch:  # Ручной запуск
  push:
    tags:
      - 'v*.*.*'

jobs:
  build-winpython:
    runs-on: ubuntu-latest  # Можем собирать на любой ОС

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Build WinPython portable bundle
      run: |
        python build_winpython.py

    - name: Upload portable ZIP artifact
      uses: actions/upload-artifact@v4
      with:
        name: NeuroWings-WinPython-Portable
        path: dist_winpython/NeuroWings-WinPython-Portable.zip
        retention-days: 30

    - name: Create Release (on tag)
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: |
          dist_winpython/NeuroWings-WinPython-Portable.zip
        body: |
          # NeuroWings Portable Release (WinPython)

          ## Установка

          1. Скачайте `NeuroWings-WinPython-Portable.zip`
          2. Распакуйте в любую папку
          3. Следуйте инструкциям в `INSTALL.txt`

          ## Требования

          - Windows 7/8/10/11 (64-bit)
          - ~600 MB свободного места
          - Интернет для первоначальной установки зависимостей

          ## Преимущества WinPython версии

          - ✅ Работает на Windows 7!
          - ✅ Не требует прав администратора
          - ✅ Полностью portable
          - ✅ 100% надёжность (нет проблем с DLL)

          ## Размер

          - Скачиваемый ZIP: ~10 MB (только код приложения)
          - WinPython: ~450 MB (скачивается отдельно)
          - Зависимости (PyTorch, etc.): ~1.5 GB (устанавливаются через INSTALL.bat)
          - **Итого: ~2 GB**

          Это больше чем PyInstaller сборка, но зато **100% работает на всех Windows**!
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
